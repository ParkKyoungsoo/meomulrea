{"remainingRequest":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\babel-loader\\lib\\index.js!C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\vuetify-loader\\lib\\loader.js??ref--17-0!C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\SSAFY\\git\\s03p23b304\\fe_chat\\src\\components\\Chat\\ChatList.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\src\\components\\Chat\\ChatList.vue","mtime":1600910340540},{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1574476662000},{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\SSAFY\\git\\s03p23b304\\fe_chat\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0ICogYXMgZmlyZWJhc2UgZnJvbSAnZmlyZWJhc2UnOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRlZENoYXRzOiBbXSwKICAgICAgbG9hZGluZzogZmFsc2UKICAgIH07CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdGhpcy5sb2FkUmVjZW50Q2hhdHMoKTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICB1c2VyOiBmdW5jdGlvbiB1c2VyKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVycy51c2VyOwogICAgfSwKICAgIGNoYXRzOiBmdW5jdGlvbiBjaGF0cygpIHsKICAgICAgcmV0dXJuIHRoaXMubG9hZGVkQ2hhdHM7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2FkUmVjZW50Q2hhdHM6IGZ1bmN0aW9uIGxvYWRSZWNlbnRDaGF0cyhsYXN0S2V5KSB7CiAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoJ2NoYXRzJykub3JkZXJCeUtleSgpLmxpbWl0VG9MYXN0KDIwKS5vbmNlKCJ2YWx1ZSIsIGZ1bmN0aW9uIChzbmFwc2hvdCkgewogICAgICAgIHNuYXBzaG90LmZvckVhY2goZnVuY3Rpb24gKGNoaWxkU25hcHNob3QpIHsKICAgICAgICAgIHZhciBjaGF0ID0gY2hpbGRTbmFwc2hvdC52YWwoKTsKICAgICAgICAgIGNoYXQua2V5ID0gY2hpbGRTbmFwc2hvdC5rZXk7CiAgICAgICAgICB0aGF0LmdldFVzZXJDb3VudEZvckNoYXQoY2hhdCk7CiAgICAgICAgICB0aGF0LmxvYWRlZENoYXRzLnVuc2hpZnQoY2hhdCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWRSZWNlbnRDaGF0c0J5TGFzdEtleTogZnVuY3Rpb24gbG9hZFJlY2VudENoYXRzQnlMYXN0S2V5KGxhc3RLZXkpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICB0aGF0LmxvYWRpbmcgPSB0cnVlOwogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignY2hhdHMnKS5vcmRlckJ5S2V5KCkuZW5kQXQobGFzdEtleSkubGltaXRUb0xhc3QoMjApLm9uY2UoInZhbHVlIiwgZnVuY3Rpb24gKHNuYXBzaG90KSB7CiAgICAgICAgdmFyIHRlbXBBcnJheSA9IFtdOwogICAgICAgIHNuYXBzaG90LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLmtleSAhPSBsYXN0S2V5KSB7CiAgICAgICAgICAgIHZhciBuZXdDaGF0ID0gaXRlbS52YWwoKTsKICAgICAgICAgICAgbmV3Q2hhdC5rZXkgPSBpdGVtLmtleTsKICAgICAgICAgICAgdGVtcEFycmF5LnB1c2gobmV3Q2hhdCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKHRlbXBBcnJheVswXS5rZXkgPT09IHRlbXBBcnJheVsxXS5rZXkpIHJldHVybjsKICAgICAgICB0ZW1wQXJyYXkucmV2ZXJzZSgpOwogICAgICAgIHRlbXBBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgdGhhdC5nZXRVc2VyQ291bnRGb3JDaGF0KGNoaWxkKTsKICAgICAgICAgIHRoYXQubG9hZGVkQ2hhdHMucHVzaChjaGlsZCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhhdC5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKICAgIGVudGVyQ2hhdDogZnVuY3Rpb24gZW50ZXJDaGF0KGNoYXQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChjaGF0LmlzQWxyZWFkeUpvaW5lZCB8fCBjaGF0LnVzZXJDb3VudCA9PSBudWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgY2hhdElkID0gY2hhdC5rZXk7CiAgICAgIHZhciB0aW1lID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7CiAgICAgIHZhciB1cGRhdGVzID0ge307CiAgICAgIHVwZGF0ZXNbJy9jaGF0X21lbWJlcnMvJyArIGNoYXRJZCArICcvdXNlcnMvJyArIHRoaXMudXNlci5pZF0gPSB7CiAgICAgICAgdGltZXN0YW1wOiB0aW1lCiAgICAgIH07CiAgICAgIHVwZGF0ZXNbJ3VzZXJzLycgKyB0aGlzLnVzZXIuaWQgKyAnL2NoYXRzLycgKyBjaGF0SWRdID0gewogICAgICAgIHRpbWVzdGFtcDogdGltZQogICAgICB9OwogICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgIGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCkudXBkYXRlKHVwZGF0ZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLiRyb3V0ZXIucHVzaCgnL2NoYXQvJyArIGNoYXRJZCk7CiAgICAgIH0pOwogICAgfSwKICAgIG9uU2Nyb2xsOiBmdW5jdGlvbiBvblNjcm9sbCgpIHsKICAgICAgaWYgKHdpbmRvdy50b3Auc2Nyb2xsWSArIHdpbmRvdy5pbm5lckhlaWdodCA+PSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCAtIDEwMCAmJiAhdGhpcy5sb2FkaW5nKSB7CiAgICAgICAgdGhpcy5sb2FkUmVjZW50Q2hhdHNCeUxhc3RLZXkodGhpcy5sb2FkZWRDaGF0c1t0aGlzLmxvYWRlZENoYXRzLmxlbmd0aCAtIDFdLmtleSk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRVc2VyQ291bnRGb3JDaGF0OiBmdW5jdGlvbiBnZXRVc2VyQ291bnRGb3JDaGF0KGNoYXQpIHsKICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignY2hhdF9tZW1iZXJzJykuY2hpbGQoY2hhdC5rZXkpLmNoaWxkKCJ1c2VycyIpLm9uY2UoInZhbHVlIiwgZnVuY3Rpb24gKHNuYXBzaG90KSB7CiAgICAgICAgdGhhdC4kc2V0KGNoYXQsICJ1c2VyQ291bnQiLCBzbmFwc2hvdC5udW1DaGlsZHJlbigpKTsKICAgICAgICBzbmFwc2hvdC5mb3JFYWNoKGZ1bmN0aW9uICh1c2VyKSB7CiAgICAgICAgICBpZiAodXNlci5rZXkgPT0gdGhhdC51c2VyLmlkKSB7CiAgICAgICAgICAgIHRoYXQuJHNldChjaGF0LCAiaXNBbHJlYWR5Sm9pbmVkIiwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTsKICB9LAogIGRlc3Ryb3llZDogZnVuY3Rpb24gZGVzdHJveWVkKCkgewogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMub25TY3JvbGwpOwogIH0sCiAgd2F0Y2g6IHsKICAgIGxvYWRlZENoYXRzOiB7CiAgICAgIGRlZXA6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIoKSB7fQogICAgfQogIH0KfTs="},{"version":3,"sources":["ChatList.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <v-container v-on:scroll=\"onScroll\" ref=\"chatlistContainer\">\r\n    <v-row no-gutters>\r\n      <v-col v-for=\"chat in chats\" :key=\"chat.name\" cols=\"12\" sm=\"4\">\r\n        <v-card class=\"mx-auto\" max-width=\"344\" outlined>\r\n          <v-list-item three-line>\r\n            <v-list-item-content>\r\n              <div class=\"overline mb-4\">{{chat.key}}</div>\r\n              <v-list-item-title class=\"headline mb-1\">{{chat.name}}</v-list-item-title>\r\n              <v-list-item-subtitle v-if=\"chat.userCount != null\">{{chat.userCount}} members have joined this chat.</v-list-item-subtitle>\r\n              <v-list-item-subtitle v-else>Loading user count...</v-list-item-subtitle>\r\n            </v-list-item-content>\r\n          </v-list-item>\r\n          <v-card-actions>\r\n            <v-btn text @click=\"enterChat(chat)\" v-if=\"!chat.isAlreadyJoined && chat.userCount != null\">Join</v-btn>\r\n            <v-btn text disabled v-if=\"chat.isAlreadyJoined\">Joined</v-btn>\r\n          </v-card-actions>\r\n        </v-card>\r\n      </v-col>\r\n    </v-row>\r\n  </v-container>\r\n</template>\r\n\r\n<script>\r\nimport * as firebase from 'firebase'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      loadedChats: [],\r\n      loading: false\r\n    }\r\n  },\r\n  mounted () {\r\n    this.loadRecentChats()\r\n  },\r\n  computed: {\r\n    user () {\r\n      return this.$store.getters.user\r\n    },\r\n    chats () {\r\n      return this.loadedChats\r\n    }\r\n  },\r\n  methods: {\r\n    loadRecentChats (lastKey) {\r\n      let that = this\r\n      firebase.database().ref('chats').orderByKey().limitToLast(20).once(\"value\", function(snapshot) {\r\n        snapshot.forEach(function(childSnapshot) {\r\n          let chat = childSnapshot.val()\r\n          chat.key = childSnapshot.key\r\n          that.getUserCountForChat(chat)\r\n          that.loadedChats.unshift(chat)\r\n        })\r\n      })\r\n    },\r\n    loadRecentChatsByLastKey (lastKey) {\r\n      let that = this\r\n      that.loading = true\r\n      firebase.database().ref('chats').orderByKey().endAt(lastKey).limitToLast(20).once(\"value\", function(snapshot) {\r\n        let tempArray = []\r\n        snapshot.forEach(function (item) {\r\n          if(item.key != lastKey) {\r\n            let newChat = item.val()\r\n            newChat.key = item.key\r\n            tempArray.push(newChat)\r\n          }\r\n        })\r\n        if (tempArray[0].key === tempArray[1].key) return\r\n        tempArray.reverse()\r\n        tempArray.forEach(function (child) {\r\n          that.getUserCountForChat(child)\r\n          that.loadedChats.push(child)\r\n        })\r\n        that.loading = false\r\n      })\r\n    },\r\n    enterChat (chat) {\r\n      if(chat.isAlreadyJoined || chat.userCount == null) {\r\n        return\r\n      }\r\n\r\n      let chatId = chat.key\r\n      let time = new Date().valueOf()\r\n\r\n      let updates = {}\r\n      updates['/chat_members/' + chatId + '/users/' + this.user.id] = {timestamp: time}\r\n      updates['users/' + this.user.id + '/chats/' + chatId] = {timestamp: time}\r\n\r\n      let that = this\r\n      firebase.database().ref().update(updates).then(() => {\r\n        this.$router.push('/chat/' + chatId)\r\n      })\r\n    },\r\n    onScroll() {\r\n      if(window.top.scrollY + window.innerHeight >= document.body.scrollHeight - 100 && !this.loading) {\r\n        this.loadRecentChatsByLastKey(this.loadedChats[this.loadedChats.length - 1].key)\r\n      }\r\n    },\r\n    getUserCountForChat(chat) {\r\n      let that = this\r\n      firebase.database().ref('chat_members').child(chat.key).child(\"users\").once(\"value\", function(snapshot) {\r\n        that.$set(chat, \"userCount\", snapshot.numChildren())\r\n        snapshot.forEach((user) => {\r\n          if(user.key == that.user.id) {\r\n            that.$set(chat, \"isAlreadyJoined\", true)\r\n          }\r\n        })\r\n      })\r\n    }\r\n  },\r\n  created () {\r\n    window.addEventListener('scroll', this.onScroll)\r\n  },\r\n  destroyed () {\r\n    window.removeEventListener('scroll', this.onScroll)\r\n  },\r\n  watch: {\r\n    loadedChats: {\r\n      deep: true,\r\n      handler() {\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>"],"sourceRoot":"src/components/Chat"}]}